var spawn = require("child_process").spawn;
var path = require("path");
var testFile = path.join(__dirname, "/ignore_node_modules/**/*.spec.js");
var bin = path.join(__dirname, "../bin/tape");

execute("node", [bin, testFile, "-i"]);

/**
 * execute given command in a node child process
 * @param {String} proc - process command name
 * @param {[String]} args - array of process arguments
 * @return {Promise<any>}
 */
function execute(proc, args) {
    console.info("spawning ", proc, args.join(" "));
    var cmd = spawn(proc, args, {
        cwd: path.join(__dirname, ".."),
        env: process.env
    });

    cmd.stdout.on("data", function (data) {
        console.log(data.toString());
    });

    cmd.stderr.on("data", function (data) {
        console.warn(data.toString());
    });

    cmd.on("close", function (code) {
        console.log('Child exited with code ' + code);
    });

    cmd.on("error", function (code) {
        console.error('Error while spawning ' + proc + ' ' + code + ' ' + arguments.join(" "));
    });
}